# üîí –ú–∏–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ (v1.0):
- ‚ùå XOR —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (–ª–µ–≥–∫–æ –≤–∑–ª–∞–º—ã–≤–∞–µ—Ç—Å—è)
- ‚ùå –ö–æ—Ä–æ—Ç–∫–∏–π –∫–ª—é—á
- ‚ùå –ù–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ (–æ–¥–∏–Ω –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö)
- ‚ùå –£—è–∑–≤–∏–º–æ –∫ frequency analysis

### –ü–æ—Å–ª–µ (v2.0):
- ‚úÖ **AES-256-GCM** —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Web Crypto API
- ‚úÖ **PBKDF2** —Å 100,000 –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è key derivation
- ‚úÖ **–°–ª—É—á–∞–π–Ω—ã–π IV** –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **Authenticated encryption** (–∑–∞—â–∏—Ç–∞ –æ—Ç tampering)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. **–°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä—É—é—Ç—Å—è** (–±—ã–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã XOR)
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç—è—Ç—Å—è** –∏–∑ localStorage
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
4. **–ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞** —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å –Ω–æ–≤—ã–º AES-GCM —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º

**–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –ü—Ä–æ—Å—Ç–æ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.

---

## üë®‚Äçüíª –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ API

–í—Å–µ –º–µ—Ç–æ–¥—ã `tokenStorage` —Ç–µ–ø–µ—Ä—å **async**:

```typescript
// ‚ùå –°—Ç–∞—Ä—ã–π –∫–æ–¥
const token = tokenStorage.getAccessToken();
tokenStorage.setAccessToken('new-token');

// ‚úÖ –ù–æ–≤—ã–π –∫–æ–¥
const token = await tokenStorage.getAccessToken();
await tokenStorage.setAccessToken('new-token');
```

### –§–∞–π–ª—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `tokenStorage` –≤ —Å–≤–æ–µ–º –∫–æ–¥–µ:

1. **src/lib/api.ts** - ‚úÖ –£–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω
2. **src/components/auth/*.tsx** - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
3. **src/hooks/useAuth.ts** - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
4. **src/store/authStore.ts** - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```typescript
// ‚ùå –°—Ç–∞—Ä—ã–π –∫–æ–¥
const LoginForm = () => {
  const handleLogin = (accessToken, refreshToken) => {
    tokenStorage.setAccessToken(accessToken);
    tokenStorage.setRefreshToken(refreshToken);
    router.push('/');
  };
};

// ‚úÖ –ù–æ–≤—ã–π –∫–æ–¥
const LoginForm = () => {
  const handleLogin = async (accessToken, refreshToken) => {
    await tokenStorage.setAccessToken(accessToken);
    await tokenStorage.setRefreshToken(refreshToken);
    router.push('/');
  };
};
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –Ω–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

| –ê—Ç–∞–∫–∞ | XOR (—Å—Ç–∞—Ä–æ–µ) | AES-GCM (–Ω–æ–≤–æ–µ) |
|-------|--------------|-----------------|
| Frequency analysis | ‚ùå –£—è–∑–≤–∏–º–æ | ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ |
| Known-plaintext | ‚ùå –£—è–∑–≤–∏–º–æ | ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ |
| Brute force | ‚ùå –õ–µ–≥–∫–æ | ‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ |
| Tampering | ‚ùå –ù–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è |
| Replay attacks | ‚ùå –í–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π IV) |

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

```typescript
// Key Derivation
PBKDF2(
  password: encryptionKey,
  salt: 'lead-schem-secure-salt-v1',
  iterations: 100,000,
  hash: 'SHA-256'
) ‚Üí AES-256 key

// Encryption
AES-GCM-256(
  plaintext: JSON.stringify(data),
  key: derivedKey,
  iv: crypto.getRandomValues(12 bytes)
) ‚Üí ciphertext

// Storage format
{
  value: base64(IV || ciphertext),
  timestamp: Date.now(),
  ttl: 604800000,
  encrypted: true
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# 1. –û—á–∏—Å—Ç–∏—Ç—å localStorage
localStorage.clear()

# 2. –û—Ç–∫—Ä—ã—Ç—å DevTools Console
# 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç
(async () => {
  const { tokenStorage } = await import('./lib/secure-storage');
  
  // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
  await tokenStorage.setAccessToken('test-token-123');
  console.log('‚úÖ Token saved');
  
  // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
  const token = await tokenStorage.getAccessToken();
  console.log('‚úÖ Token retrieved:', token === 'test-token-123');
  
  // –¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏
  tokenStorage.clearAll();
  const empty = await tokenStorage.getAccessToken();
  console.log('‚úÖ Token cleared:', empty === null);
})();
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ Application ‚Üí Local Storage –≤ DevTools
# –ò—â–∏—Ç–µ –∫–ª—é—á–∏ –≤–∏–¥–∞: secure_accessToken
# –ó–Ω–∞—á–µ–Ω–∏–µ value –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –∏ –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ random base64
```

**–ü—Ä–∏–º–µ—Ä –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:**
```json
{
  "value": "kJ8xN2mP5qR7sT9vW1yZ3aB4cD6eF8gH0iJ2kL4mN6oP8qR0sT2uV4wX6yZ8aB0cD==",
  "timestamp": 1730304000000,
  "ttl": 604800000,
  "encrypted": true
}
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –®–∞–≥–∏ –¥–ª—è production

1. **Backup —Ç–µ–∫—É—â–µ–π localStorage** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```typescript
   // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   const backup = JSON.stringify(localStorage);
   ```

2. **–î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞**:
   ```bash
   npm run build
   docker build -t frontend-callcentre:2.0.0 .
   kubectl set image deployment/frontend-callcentre frontend=frontend-callcentre:2.0.0
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ª–æ–≥–∏–Ω–æ–≤
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

4. **–£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:
   > ‚ö†Ô∏è –î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.
   > –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to encrypt data"

**–ü—Ä–∏—á–∏–Ω–∞:** Web Crypto API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (HTTP –≤–º–µ—Å—Ç–æ HTTPS –∏–ª–∏ —Å—Ç–∞—Ä—ã–π –±—Ä–∞—É–∑–µ—Ä)

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
if (!crypto.subtle) {
  console.error('Web Crypto API not available. Use HTTPS.');
  // Fallback: –Ω–µ —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to decrypt data"

**–ü—Ä–∏—á–∏–Ω–∞:** –î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞—Ä—ã–º –º–µ—Ç–æ–¥–æ–º (XOR)

**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å async/await –≤ auth –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –≤—ã–∑–æ–≤—ã tokenStorage –∏–º–µ—é—Ç `await`

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
- GitHub Issues
- DevOps Team
- Security Team

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

